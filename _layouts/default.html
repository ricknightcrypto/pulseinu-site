<!doctype html>
<html lang="en">

<head>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="application/javascript">
    </script>

    <!-- Pull this into the project? -->
    <script async src="https://cdn.jsdelivr.net/npm/merkletreejs@latest/merkletree.js"></script>
    <script async src="https://cdn.jsdelivr.net/npm/keccak256@latest/keccak256.js"></script>

    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="SHIB Ecosystem On Pulsechain">

    <script aysnc src="assets/javascripts/pulseinu.js"></script>
    <script src="/assets/javascripts/freeclaim_addresses.min.js"></script>
    <script async src="/assets/javascripts/referrer_addresses.js"></script>
    <script async src="/assets/javascripts/early_adopters.js"></script>
    <script async src="/assets/javascripts/utility_functions.js"></script>
    <link rel="stylesheet" href="/assets/css/custom.css">
    <link rel="stylesheet" href="/assets/css/tingle.min.css">
    <script src="/assets/javascripts/tingle.min.js"></script>
    <script src="/assets/javascripts/modal.js"></script>
    <script src="/assets/javascripts/loading-spinner.js"></script>

    <meta charset="utf-8">
    <title>Pulse Inu</title>

    <style>
        a {
            all: unset;
            cursor: pointer;
        }

        button {
            cursor: pointer;
        }

        body {
            background: black;
            color: white;
            font-family: 'Poppins', sans-serif;
            font-display: optional;
        }

        input {
            background-color: black;
            border: 1px solid white;
            color: white;
            border-radius: 100rem;
            height: 50px;
            font-size: 19px;
            font-weight: bold;
            text-align: center;
        }

        /* Chrome, Safari, Edge, Opera */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Firefox */
        input[type=number] {
            -moz-appearance: textField;
        }

        .nav {
            display: flex;
            align-items: center;
            justify-content: space-evenly;
            margin-top: 5%;
            padding-bottom: 1%;
            -moz-column-gap: 15%;
            column-gap: 15%;
        }


        .logo {
            display: flex;
            align-items: center;
        }

        .title {
            font-weight: bold;
            margin-left: 19px;
            font-size: 30px;
        }

        .menu {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .actions {
            display: flex;
        }

        .header {
            text-align: center;
            font-weight: bold;
            text-align: center;
            font-weight: bold;
            font-size: 39px;
            margin-top: 4%;
            color: #D7E0FF;
        }

        .subheader {
            text-align: center;
            text-align: center;
            margin-top: 4%;
            font-size: 25px;
            color: #D7E0FF;
        }

        .action_buttons {
            text-align: center;
            font-weight: bold;
            margin-top: 4%;
            display: flex;
            justify-content: space-evenly;
        }

        @font-face {
            font-family: 'Poppins';
            src: url("assets/fonts/PoppinsR.ttf");
            font-display: swap;
        }

        @font-face {
            font-family: 'Poppins';
            src: url("assets/fonts/PoppinsB.ttf");
            font-weight: bold;
        }

        .connect-btn {
            height: 32px;
            border-radius: 20px;
            width: 152px;
            border: none;
            background: linear-gradient(0.25turn, #FF0000, #F00F8E, #4F30FF, #00E8FC);
            box-shadow: 0px 0px 52px rgba(204, 19, 236, 0.46);
            color: white;
            font-weight: bold;
        }

        .connect-btn-lg {
            height: 58px;
            border-radius: 50px;
            width: 243px;
            border: none;
            background: linear-gradient(0.25turn, #FF0000, #F00F8E, #4F30FF, #00E8FC);
            box-shadow: 0px 0px 52px rgba(204, 19, 236, 0.46);
            color: white;
            font-weight: bold;
            font-size: 25px;
        }

        button.mint-btn {
            height: 58px;
            border-radius: 100rem;
            font-size: 25px;
            padding: .5rem 3rem;
            color: white;
            box-shadow: 0 0 6px 0 rgba(157, 96, 212, 0.5);
            border: solid 3px transparent;
            background-image: linear-gradient(rgba(255, 255, 255, 0), rgba(255, 255, 255, 0)), linear-gradient(0.25turn, #FF0000, #F00F8E, #4F30FF, #00E8FC);
            background-origin: border-box;
            background-clip: content-box, border-box;
            box-shadow: 2px 1000px 1px black inset;
            font-weight: bold;
        }

        button.mint-btn:hover {
            box-shadow: none;
            color: white
        }

        .disabled-claim-btn {
            color: rgb(229, 226, 226) !important;
            background: rgb(82, 80, 80) !important;
            box-shadow: 0px 0px 52px rgba(233, 231, 233, 0.46) !important;
        }

        .chart-container {
            text-align: center;
        }

        .exclusive {
            color: #f00f8e;
        }

        .pump-harder {
            color: #f60954;
        }

        .electric-blue {
            color: #00E8FC;
        }

        .store-of-val {
            margin-bottom: 5%;
        }

        .benefits {
            font-size: 20px;
        }

        .mint-pinu {
            display: flex;
            text-align: center;
            justify-content: space-evenly;
            margin-top: 5%;
            padding-left: 18%;
            padding-right: 10%
        }

        .claims {
            display: flex;
            text-align: center;
            justify-content: space-evenly;
            margin-top: 5%;
            padding-left: 5%;
            padding-right: 5%;
        }

        .mint-prompt-1,
        .mint-prompt-2 {
            margin-bottom: 5%;
            margin-bottom: 5%;
        }

        .testnet-banner {
            background: linear-gradient(0.25turn, #FF0000, #F00F8E, #4F30FF, #00E8FC);
            text-align: center;
        }

        label {
            display: block;
        }

        @media (max-width: 800px) {

            .nav,
            .menu,
            .logo {
                flex-direction: column;
            }

            .logo {
                margin-bottom: 20px;
            }
        }

        /* Style Bulleted List */

        ul {
            list-style: none;
            /* Remove default bullets */
        }

        ul li::before {
            content: "\2022";
            color: #04defc;
            font-weight: bold;
            display: inline-block;
            width: 2em;
            margin-left: -1em;
        }
    </style>
</head>

<body>
    <div class="testnet-banner" id="network_alert">

    </div>
    <div class="nav">
        <a href="/">
            <div class="logo">
                <img width="80" height="80" alt="navigation logo" class="img" src="assets/images/pinu_small.png" />
                <span class="title">PULSE INU</span>
            </div>
        </a>
        <div class="menu">
            <a href="/whitepaper.pdf">
                <b>Whitepaper</b>
            </a>

            <a href="https://t.me/+Z5uINrmzvE9lNjNh">
                <img width="22" style="display:block;" alt="telegram" src="assets/images/telegram.png" />
            </a>
            <a href="https://twitter.com/PulseInu">
                <img width="22" style="display:block;" alt="twitter" src="assets/images/twitter.png" />
            </a>
            <a href="#" onclick="addTokenFunction()">
                <img width="25" style="display:block;" alt="metamask" src="assets/images/metamask.webp">
            </a>

            <button onclick="init()" class="connect-btn disconnected">Connect & Claim</button>
            <button class="connect-btn connected" style="display: none;">Connected</button>
        </div>
    </div>
    {{ content }}
</body>

</html>

<script>
    const REQUIRED_NETWORK_ID = 943;
    const REQUIRED_RPC_URL = 'https://rpc.v4.testnet.pulsechain.com';
    const REQUIRED_NETWORK_NAME = 'Pulsechain';
    const REQUIRED_NETWORK = 'testnet';
    const REQUIRED_SYMBOL = 'tPLS';
    const REQUIRED_BLOCK_EXPLORER_URL = "https://scan.v4.testnet.pulsechain.com";

    let pulseInuContract;
    let callingAccount;
    let isInitialized = false
    let contractInfo;
    let countInterval = null;
    const connectedBtn = document.getElementsByClassName('connected')[0];
    const disconnectedBtn = document.getElementsByClassName('disconnected')[0];
    const claimBtnsLg = document.getElementsByClassName(' action-btn');
    const mintBtns = document.getElementsByClassName('mint-action-btn');
    const notEligibleText = document.getElementsByClassName('not-eligible-text');
    const referrerBtn = document.getElementById('claimReferrer');
    const withdrawBtn = document.getElementById('withdrawBtn');
    const earlyBtn = document.getElementById('earlyAdopter');

    /**
     * @param {Object} object
     * @param {string} key
     * @return {any} value
     */
    const getParameterCaseInsensitive = (object, key) => {
        const asLowercase = key.toLowerCase();
        return object[Object.keys(object)
            .find(k => k.toLowerCase() === asLowercase)
        ];
    };

    const fetchError = (err, nocheck = false) => {
        if (!nocheck) {
            if (err.indexOf('wallet_switchEthereumChain') > -1) {
                err = 'Switch Request is already pending.';
            } else if (err.indexOf('User denied transaction signature.') > -1 || err.indexOf('loadingDefaults') > -1) {
                err = 'User denied transaction.';
            } else {
                if (err.indexOf('NOT_AIRDROP_CLAIMABLE_ADDR') > -1) {
                    err = "Your address isn't eligible to claim airdrop.";
                } else if (err.indexOf('NOT_REFERRER_CLAIMABLE_ADDR_PERCENT') > -1) {
                    err = "Your address and percent isn't eligible to claim referrer reward.";
                } else if (err.indexOf('NOT_FIRST_ADOPTER_CLAIMABLE_ADDR') > -1) {
                    err = "Your address isn't eligible to claim first adopter reward.";
                } else if (err.indexOf('MINT_TIMEIN') > -1) {
                    err = 'The mint period is still ongoing!';
                } else if (err.indexOf('FAILED_WITHDRAW') > -1) {
                    err = "Failed to transfer funds to the owner's address.";
                } else if (err.indexOf('NOT_OWNER') > -1) {
                    err = "You're not a contract owner.";
                } else if (err.indexOf('MINT_TIMEOUT') > -1) {
                    err = 'The mint period ends!';
                } else if (err.indexOf('AT_LEAST_1_PINU') > -1) {
                    err = 'You must mint at least 1 PINU.';
                } else if (err.indexOf('ALREADY_CLAIMED') > -1) {
                    err = 'You claimed already.';
                } else if (err.indexOf('AIRDROP_TIMEOUT') > -1) {
                    err = "AIRDROP_TIMEOUT";
                } else {
                    err = 'Unexpected Error.'
                }
            }
        }

        openModal(err, false);
        console.log(err);
    };

    const checkNetwork = (bShow = true) => {
        let network = document.getElementById('network_alert').getAttribute('network_id');
        if (network != REQUIRED_NETWORK_ID && bShow) {
            fetchError(document.getElementById('network_alert').innerHTML, true);
        }
        return network == REQUIRED_NETWORK_ID;
    };

    const makeTimeString = (time) => {
        if (time < 0) {
            return '00:00:00';
        }
        let seconds = Math.floor(time / 1000);
        let days = Math.floor(seconds / 3600 / 24);
        let hours = Math.floor((seconds - days * 3600 * 24) / 3600);
        let mins = Math.floor((seconds - - days * 3600 * 24 - hours * 3600) / 60);
        seconds = seconds - days * 3600 * 24 - hours * 3600 - mins * 60;
        return (days > 1 ? days + ' days ' : days == 1 ? days + ' day ' : '') + (hours < 10 ? '0' + hours : hours) + ':' + (mins < 10 ? '0' + mins : mins) + ':' + (seconds < 10 ? '0' + seconds : seconds);
    }

    const initButtonByAccount = (account) => {
        
        if (claimBtnsLg.length === 0 && mintBtns.length === 0 && !referrerBtn && !earlyBtn && !withdrawBtn && countInterval !== null) {
            clearInterval(countInterval);
            countInterval = null;
            return;
        }

        const airdropEndTime = Number(contractInfo?.airdropEndTime?._hex) * 1000;
        const currentTime = new Date().getTime();
        const mintEndTime = Number(contractInfo?.mintEndTime?._hex) * 1000;
        if (account === undefined) {
            connectedBtn.style.display = "none";
            disconnectedBtn.style.display = "block";
        } else {
            connectedBtn.style.display = "block";
            disconnectedBtn.style.display = "none";
        }
        // todo: put this into a function
        if (!checkNetwork(false) || !isInitialized || !contractInfo || account === undefined || F.findIndex(item => account.toString().toLowerCase() == item.toLowerCase()) === -1) {
            for (let btn of claimBtnsLg) {
                btn.classList.add("disabled-claim-btn");
                btn.disabled = true;
                if (account === undefined || F.findIndex(item => account.toString().toLowerCase() == item.toLowerCase()) === -1) {
                    btn.nextSibling.nextSibling.innerHTML = '<p class="not-eligible-text">Not Eligible For Claim Airdrop</p>';
                    btn.nextSibling.nextSibling.nextSibling.nextSibling.innerHTML = '';
                }
            }
            for (let txt of notEligibleText) {
                txt.style.display = "block";
            }
        } else {
            for (let btn of claimBtnsLg) {
                if (airdropEndTime < currentTime) {
                    btn.classList.add("disabled-claim-btn");
                    btn.disabled = true;
                } else {
                    btn.classList.remove("disabled-claim-btn");
                    btn.disabled = false;
                }
                if (airdropEndTime <= currentTime) {
                    btn.nextSibling.nextSibling.innerHTML = 'Ended';
                    btn.nextSibling.nextSibling.nextSibling.nextSibling.innerHTML = '';
                } else {
                    btn.nextSibling.nextSibling.innerHTML = 'Ends in';
                    btn.nextSibling.nextSibling.nextSibling.nextSibling.innerHTML = makeTimeString(airdropEndTime - currentTime);
                }
            }

            for (let txt of notEligibleText) {
                txt.style.display = "none";
            }
        }

        if (!checkNetwork(false) || !isInitialized || !contractInfo || account === undefined) {
            for (let btn of mintBtns) {
                btn.classList.add("disabled-claim-btn");
                btn.disabled = true;
                if (account === undefined) {
                    btn.nextSibling.nextSibling.innerHTML = '<p class="not-eligible-text">Not Eligible For Mint</p>';
                    btn.nextSibling.nextSibling.nextSibling.nextSibling.innerHTML = '';
                }
            }
        } else {
            for (let btn of mintBtns) {
                if (mintEndTime < currentTime) {
                    btn.classList.add("disabled-claim-btn");
                    btn.disabled = true;
                } else {
                    btn.classList.remove("disabled-claim-btn");
                    btn.disabled = false;
                }
                if (mintEndTime <= currentTime) {
                    btn.nextSibling.nextSibling.innerHTML = 'Ended';
                    btn.nextSibling.nextSibling.nextSibling.nextSibling.innerHTML = '';
                } else {
                    btn.nextSibling.nextSibling.innerHTML = 'Ends in';
                    btn.nextSibling.nextSibling.nextSibling.nextSibling.innerHTML = makeTimeString(mintEndTime - currentTime);
                }
            }

            for (let txt of notEligibleText) {
                txt.style.display = "none";
            }
        }

        if (referrerBtn) {
            if (!checkNetwork(false) || !isInitialized || !contractInfo || account === undefined || getParameterCaseInsensitive(dict, account) == undefined) {
                referrerBtn.classList.add("disabled-claim-btn");
                referrerBtn.disabled = true;
                if (account === undefined || getParameterCaseInsensitive(dict, account) == undefined) {
                    referrerBtn.nextSibling.nextSibling.innerHTML = '<p class="not-eligible-text">Not Eligible For Referrer</p>';
                    referrerBtn.nextSibling.nextSibling.nextSibling.nextSibling.innerHTML = '';
                }
            } else {
                console.log(mintEndTime > currentTime);
                if (mintEndTime > currentTime) {
                    referrerBtn.classList.add("disabled-claim-btn");
                    referrerBtn.disabled = true;
                } else {
                    referrerBtn.classList.remove("disabled-claim-btn");
                    referrerBtn.disabled = false;
                }

                if (mintEndTime <= currentTime) {
                    referrerBtn.nextSibling.nextSibling.innerHTML = '';
                    referrerBtn.nextSibling.nextSibling.nextSibling.nextSibling.innerHTML = '';
                } else {
                    referrerBtn.nextSibling.nextSibling.innerHTML = 'Starts in';
                    referrerBtn.nextSibling.nextSibling.nextSibling.nextSibling.innerHTML = makeTimeString(mintEndTime - currentTime);
                }
            }
        }

        if (earlyBtn) {
            if (!checkNetwork(false) || !isInitialized || !contractInfo || account === undefined || ADOPTERS.findIndex(item => account.toString().toLowerCase() == item.toLowerCase()) === -1) {
                earlyBtn.classList.add("disabled-claim-btn");
                earlyBtn.disabled = true;
                if (account === undefined || ADOPTERS.findIndex(item => account.toString().toLowerCase() == item.toLowerCase())) {
                    earlyBtn.nextSibling.nextSibling.innerHTML = '<p class="not-eligible-text">Not Eligible For Early Adopter</p>';
                    earlyBtn.nextSibling.nextSibling.nextSibling.nextSibling.innerHTML = '';
                }
            } else {
                if (mintEndTime > currentTime) {
                    earlyBtn.classList.add("disabled-claim-btn");
                    earlyBtn.disabled = true;
                } else {
                    earlyBtn.classList.remove("disabled-claim-btn");
                    earlyBtn.disabled = false;
                }
                if (mintEndTime <= currentTime) {
                    earlyBtn.nextSibling.nextSibling.innerHTML = '';
                    earlyBtn.nextSibling.nextSibling.nextSibling.nextSibling.innerHTML = '';
                } else {
                    earlyBtn.nextSibling.nextSibling.innerHTML = 'Starts in';
                    earlyBtn.nextSibling.nextSibling.nextSibling.nextSibling.innerHTML = makeTimeString(mintEndTime - currentTime);
                }
            }
        }

        if (withdrawBtn) {
            if (!checkNetwork(false) || !isInitialized || !contractInfo || account === undefined) {
                withdrawBtn.classList.add("disabled-claim-btn");
                withdrawBtn.disabled = true;
                if (account === undefined) {
                    withdrawBtn.nextSibling.nextSibling.innerHTML = '<p class="not-eligible-text">Not Eligible For Withdraw</p>';
                    withdrawBtn.nextSibling.nextSibling.nextSibling.nextSibling.innerHTML = '';
                }
            } else {
                if (mintEndTime > currentTime) {
                    withdrawBtn.classList.add("disabled-claim-btn");
                    withdrawBtn.disabled = true;
                } else {
                    withdrawBtn.classList.remove("disabled-claim-btn");
                    withdrawBtn.disabled = false;
                }
                if (mintEndTime <= currentTime) {
                    withdrawBtn.nextSibling.nextSibling.innerHTML = '';
                    withdrawBtn.nextSibling.nextSibling.nextSibling.nextSibling.innerHTML = '';
                } else {
                    withdrawBtn.nextSibling.nextSibling.innerHTML = 'Possible in';
                    withdrawBtn.nextSibling.nextSibling.nextSibling.nextSibling.innerHTML = makeTimeString(mintEndTime - currentTime);
                }
            }
        }

    };

    const getContractInfo = () => {
        pulseInuContract
            .contractInfo()
            .then((res) => {
                contractInfo = res;
            }).catch((err) => {
                console.log(err);
            });
    };

    const handleAccountsChanged = (accounts) => {
        callingAccount = accounts && accounts.length > 0 ? accounts[0] : undefined;
        initButtonByAccount(callingAccount);
    };

    const handleChainChanged = (networkId) => {
        console.log(networkId);
        if (REQUIRED_NETWORK_ID == networkId) {
            document.getElementById('network_alert').innerHTML = 'Site not live until Pulsechain mainnet.';
        } else {
            document.getElementById('network_alert').innerHTML = 'Switch to Pulsechain testnet to use website.(<a>Switch</a>)';
        }
        window.scrollTo({ top: 0, behavior: 'smooth' });
        document.getElementById('network_alert').setAttribute('network_id', parseInt(networkId));
        if (checkNetwork(false)) {
            init();
            getContractInfo();
        }
    };

    // Initialize Connection to Metamask
    const init = async () => {
        if (typeof window.ethereum !== 'undefined') {
            isInitialized = false;
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            const signer = provider.getSigner();
            provider.send("eth_requestAccounts", []).then(() => {
                signer
                    .getAddress()
                    .then((account) => {
                        callingAccount = account
                        countInterval = setInterval(() => {
                            initButtonByAccount(callingAccount);
                        }, 1000);
                    }).catch((err) => {
                        console.log(err);
                    });

            }).catch((error) => {
                console.log(error);
                callingAccount = undefined
                countInterval = setInterval(() => {
                    initButtonByAccount(callingAccount);
                }, 1000);
            });

            window.ethereum.removeListener('accountsChanged', handleAccountsChanged);

            window.ethereum.removeListener('chainChanged', handleChainChanged);

            window.ethereum.on('accountsChanged', handleAccountsChanged);

            window.ethereum.on('chainChanged', handleChainChanged);

            provider.getNetwork().then((res) => {
                const network_id = res?.chainId;
                if (REQUIRED_NETWORK_ID == network_id) {
                    document.getElementById('network_alert').innerHTML = 'Site not live until Pulsechain mainnet.';
                } else {
                    document.getElementById('network_alert').innerHTML = 'Switch to Pulsechain testnet to use website.(<a>Switch</a>)';
                }
                document.getElementById('network_alert').setAttribute('network_id', network_id);
            }).catch((err) => {
                console.log(err);
                document.getElementById('network_alert').innerHTML = 'Switch to Pulsechain testnet to use website.(<a>Switch</a>)';
                document.getElementById('network_alert').setAttribute('network_id', undefined);
            }).finally(() => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            pulseInuContract = new ethers.Contract(
                PINU_PARAM.contractAddress,
                PINU_PARAM.abi,
                signer
            )

            isInitialized = true;
        } else {
            document.getElementById('network_alert').innerHTML = 'Please install MetaMask!';
            document.getElementById('network_alert').setAttribute('network_id', -1);
        }
    };


    document.getElementById('network_alert').addEventListener('click', () => {
        if (!checkNetwork(false) && window.ethereum) {
            window.ethereum.request({
                method: "wallet_addEthereumChain",
                params: [{
                    chainId: `0x${Number(REQUIRED_NETWORK_ID).toString(16)}`,
                    rpcUrls: [REQUIRED_RPC_URL],
                    chainName: REQUIRED_NETWORK_NAME,
                    nativeCurrency: {
                        name: REQUIRED_SYMBOL,
                        symbol: REQUIRED_SYMBOL,
                        decimals: 18
                    },
                    blockExplorerUrls: [REQUIRED_BLOCK_EXPLORER_URL]
                }]
            }).then(res => { }).catch((error) => {
                fetchError(error.message)
            });
        }
    });

    init();
    getContractInfo();

    /***
     * claimToken
     * if the user is on the list of free claim eligible lists, allow
     * the user to claim their 1,000,000,000 Pulse Inu tokens.
     * calls claimFreeClaimer(proof)
    ***/
    const claimToken = async () => {

        if (!checkNetwork()) {
            return;
        }

        Spinner();
        Spinner.show();

        let addresses = F

        // Hash leaves
        let leaves = addresses.map(addr => keccak256(addr))

        // Create tree
        let merkleTree = new MerkleTree(leaves, keccak256, { sortPairs: true })
        let rootHash = merkleTree.getRoot().toString('hex')

        let hashedAddress = keccak256(callingAccount)
        let proof = merkleTree.getHexProof(hashedAddress)

        // let v = merkleTree.verify(proof, hashedAddress, rootHash)

        pulseInuContract
            .claimFreeClaimer(proof)
            .then((res) => {
                openModal('Claimed to your account successfully!', true);
            }).catch((err) => {
                console.log(err);
                fetchError(err?.data?.message ? err?.data?.message : err?.message ? err?.message : 'Unable to Claim to your account!', false);
            }).finally(() => {
                Spinner.hide();
            });
    }
</script>